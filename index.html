<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XiXi</title>
    <style>
      .row {
        display: flex;
      }
        .cell {
            width: 10px;
            height: 10px;
            border: 1px solid #ccc;
            /* display: inline-block; */
            text-align: center;
            vertical-align: middle;
            line-height: 10px;
        }
    </style>
</head>
<body>
    <div id="minesweeper"></div>

    <script>
        let flag = false;
        const ROWS = 30;
        const COLS = 30;
        const MINE_COUNT = 250;

        const grid = [];
        const boom = [
          [3,3],[4,4],[5,5],[6,6],[7,7],[8,8],[9,9],[10,10],[11,11],  // \
          [3,11],[4,10],[5,9],[6,8],[7,7],[8,6],[9,5],[10,4],[11,3], // /
          [3,15],[4,16],[5,17],[6,18],[7,19],[8,20],[9,21],[10,22], [11,23], // \
          [3,23],[4,22],[5,21],[6,20],[7,19],[8,18],[9,17],[10,16], [11,15], // /
          [14,3],[14,4],[14,5],[15,4],[16,4],[17,4],[18,4],[19,4],[20,4],[21,4],[22,4],[23,4],[24,4],[25,4],[25,3],[25,5], // I
          [14,9],[15,8],[16,7],[17,7],[18,7],[19,7],[20,7],[21,7],[22,8],[23,9],[24,10],[25,11],[14,10],[15,11],
          [16,12],[26,12],[25,13],[24,14],[23,15],[22,16],[21,17],[20,17],[19,17],[18,17],[15,13],[14,14],[14,15],[15,16],[16,17],[17,17], // â¤ï¸
          [14,20],[15,20],[16,20],[17,20],[18,20],[19,20],[20,20],[21,20],[22,20],[23,20],[24,20],[25,21],[25,22],[25,23],[25,24],
          [24,25],[23,25],[22,25],[21,25],[20,25],[19,25],[18,25],[17,25],[16,25],[15,25],[14,25]  // U
        ];
        // åˆ›å»ºæ‰«é›·æ ¼å­
        const minesweeperContainer = document.getElementById('minesweeper');
        for (let i = 0; i < ROWS; i++) {
            const row = document.createElement('div');
            row.classList.add('row');
            // const row = [];
            const rowEl = [];
            for (let j = 0; j < COLS; j++) {
                const cell = document.createElement('div');
                // if (boom.find(d => d[0] === i && d[1] === j)) {
                //   // cell.style="background: #000";
                //   cell.textContent = 'ğŸ’£'
                // } else {
                //   cell.textContent = i + ','+ j;
                // }
                cell.classList.add('cell');
                cell.dataset.row = i;
                cell.dataset.col = j;
                cell.addEventListener('click', handleCellClick);
                row.appendChild(cell);
                rowEl.push({ element: cell, isMine: false, isRevealed: false });
            }
            grid.push(rowEl);
            minesweeperContainer.appendChild(row);
        }

        // æ”¾ç½®åœ°é›·
        const placedMines = boom.length;
        boom.forEach(item => {
          if (!grid[item[0]][item[1]].isMine) {
            grid[item[0]][item[1]].isMine = true;
          }
        });
        // while (placedMines < MINE_COUNT) {
        //     const randRow = Math.floor(Math.random() * ROWS);
        //     const randCol = Math.floor(Math.random() * COLS);
        //     if (!grid[randRow][randCol].isMine) {
        //         grid[randRow][randCol].isMine = true;
        //         placedMines++;
        //     }
        // }

        // å¤„ç†ç‚¹å‡»äº‹ä»¶
        function handleCellClick(event) {
            const row = parseInt(event.target.dataset.row);
            const col = parseInt(event.target.dataset.col);
            const cell = grid[row][col];
            if (flag) {
              return;
            }
            if (!cell.isRevealed) {
                if (cell.isMine) {
                    // event.target.textContent = 'ğŸ’£'; // ç‚¹å‡»åˆ°åœ°é›·
                    // boo 
                    document.querySelectorAll('.cell').forEach(i => {
                      const { row, col } = i.dataset;
                      console.log(row, col);
                      if (boom.find(b => b[0] == row && b[1] == col)) {
                        console.log(i)
                        i.textContent = 'ğŸ’£';
                      } else {
                        i.textContent = '';
                      }
                    });
                    flag = true;
                } else {
                    const adjacentMines = countAdjacentMines(row, col);
                    event.target.textContent = adjacentMines === 0 ? '' : adjacentMines;
                    cell.isRevealed = true;
                    if (adjacentMines === 0) {
                        // å¦‚æœå‘¨å›´æ²¡æœ‰åœ°é›·ï¼Œåˆ™é€’å½’å±•å¼€å‘¨å›´çš„ç©ºç™½æ ¼å­
                        expandEmptyCells(row, col);
                    }
                }
            }
        }

        // è®¡ç®—æŒ‡å®šæ ¼å­å‘¨å›´çš„åœ°é›·æ•°é‡
        function countAdjacentMines(row, col) {
            let count = 0;
            for (let i = Math.max(0, row - 1); i <= Math.min(ROWS - 1, row + 1); i++) {
                for (let j = Math.max(0, col - 1); j <= Math.min(COLS - 1, col + 1); j++) {
                    if (!(i === row && j === col) && grid[i][j].isMine) {
                        count++;
                    }
                }
            }
            return count;
        }

        // å±•å¼€å‘¨å›´çš„ç©ºç™½æ ¼å­
        function expandEmptyCells(row, col) {
            for (let i = Math.max(0, row - 1); i <= Math.min(ROWS - 1, row + 1); i++) {
                for (let j = Math.max(0, col - 1); j <= Math.min(COLS - 1, col + 1); j++) {
                    const cell = grid[i][j];
                    if (!cell.isRevealed && !cell.isMine) {
                        const adjacentMines = countAdjacentMines(i, j);
                        cell.isRevealed = true;
                        cell.element.textContent = adjacentMines === 0 ? '' : adjacentMines;
                        if (adjacentMines === 0) {
                            expandEmptyCells(i, j);
                        }
                    }
                }
            }
        }
    </script>
</body>
</html>
